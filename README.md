# SRE Health Checker with Prometheus & Grafana

A production-ready, concurrent health monitoring service written in Go with full observability stack including Prometheus metrics collection, Grafana dashboards, and AlertManager notifications.

![Go Version](https://img.shields.io/badge/Go-1.21%2B-blue)
![Docker](https://img.shields.io/badge/Docker-Ready-brightgreen)
![Prometheus](https://img.shields.io/badge/Prometheus-Enabled-orange)
![Grafana](https://img.shields.io/badge/Grafana-Dashboards-purple)

## üöÄ Features

### Core Health Monitoring
- **Multi-Service Monitoring** - Monitor multiple HTTP/HTTPS endpoints concurrently
- **Configurable Intervals** - Set custom check intervals and timeouts per service
- **Thread-Safe** - Concurrent-safe status updates using mutex locks
- **Detailed Logging** - Comprehensive logging of all health check events

### Observability Stack
- **Prometheus Metrics** - Automatic metrics collection and storage
- **Grafana Dashboards** - Pre-configured dashboards with real-time visualizations
- **AlertManager** - Intelligent alert routing for Slack, Email, and PagerDuty
- **Node Exporter** - System metrics (CPU, Memory, Disk usage)
- **Docker Compose** - One-command deployment of entire stack

## üìä Screenshots

### Service Dashboard
- Real-time service status (UP/DOWN)
- Response time trends
- 24-hour uptime percentage
- Health check frequency

### Available Metrics
- `service_up` - Binary metric (1=up, 0=down)
- `service_response_time_ms` - Response latency
- System metrics via Node Exporter

## üõ†Ô∏è Quick Start

### Prerequisites
- Docker Desktop (Windows/Mac) or Docker Engine (Linux)
- Docker Compose
- Git

### Installation

1. **Clone the repository**
```bash
git clone https://github.com/b95702041/sre-health-checker.git
cd sre-health-checker
```

2. **Start the monitoring stack**

**Windows (PowerShell):**
```powershell
.\setup.ps1
```

**Windows (Command Prompt):**
```cmd
setup.bat
```

**Linux/Mac:**
```bash
chmod +x setup.sh
./setup.sh
```

**Using Make:**
```bash
make setup
make up
```

3. **Access the services**
- üìä **Health Checker**: http://localhost:8080
- üìà **Grafana**: http://localhost:3000 (admin/admin)
- üîç **Prometheus**: http://localhost:9090
- üîî **AlertManager**: http://localhost:9093

## üèóÔ∏è Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         User Browser                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ                                    ‚îÇ
             ‚ñº                                    ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  Health Checker‚îÇ                   ‚îÇ    Grafana     ‚îÇ
    ‚îÇ   (Port 8080)  ‚îÇ                   ‚îÇ  (Port 3000)   ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ                                    ‚îÇ
             ‚ñº                                    ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ                    Prometheus                       ‚îÇ
    ‚îÇ                    (Port 9090)                      ‚îÇ
    ‚îÇ                                                     ‚îÇ
    ‚îÇ  ‚Ä¢ Scrapes metrics from Health Checker             ‚îÇ
    ‚îÇ  ‚Ä¢ Stores time-series data                         ‚îÇ
    ‚îÇ  ‚Ä¢ Evaluates alert rules                           ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ  AlertManager  ‚îÇ
              ‚îÇ  (Port 9093)   ‚îÇ
              ‚îÇ                ‚îÇ
              ‚îÇ ‚Ä¢ Slack        ‚îÇ
              ‚îÇ ‚Ä¢ Email        ‚îÇ
              ‚îÇ ‚Ä¢ PagerDuty    ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìÅ Project Structure

```
sre-health-checker/
‚îú‚îÄ‚îÄ main.go                          # Main application code
‚îú‚îÄ‚îÄ go.mod                           # Go module file
‚îú‚îÄ‚îÄ docker-compose.yml               # Docker Compose configuration
‚îú‚îÄ‚îÄ Dockerfile                       # Multi-stage Docker build
‚îú‚îÄ‚îÄ Makefile                         # Build and management commands
‚îú‚îÄ‚îÄ setup.ps1                        # Windows PowerShell setup
‚îú‚îÄ‚îÄ setup.bat                        # Windows batch setup
‚îú‚îÄ‚îÄ setup.sh                         # Linux/Mac setup script
‚îú‚îÄ‚îÄ prometheus/
‚îÇ   ‚îú‚îÄ‚îÄ prometheus.yml               # Prometheus configuration
‚îÇ   ‚îî‚îÄ‚îÄ alerts.yml                   # Alert rules
‚îú‚îÄ‚îÄ grafana/
‚îÇ   ‚îú‚îÄ‚îÄ provisioning/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ datasources/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prometheus.yml      # Datasource configuration
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dashboards/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ dashboard.yml        # Dashboard provisioning
‚îÇ   ‚îî‚îÄ‚îÄ dashboards/
‚îÇ       ‚îî‚îÄ‚îÄ sre-health-dashboard.json # Pre-built dashboard
‚îî‚îÄ‚îÄ alertmanager/
    ‚îî‚îÄ‚îÄ alertmanager.yml             # Alert routing configuration
```

## üîß Configuration

### Adding Services to Monitor

Edit the `services` slice in `main.go`:

```go
services := []Service{
    {
        Name:     "my-api",
        URL:      "https://api.example.com/health",
        Interval: 30 * time.Second,
        Timeout:  5 * time.Second,
    },
    // Add more services here
}
```

Then rebuild:
```bash
docker-compose build
docker-compose up -d
```

### Configuring Alerts

Edit `prometheus/alerts.yml` to customize alert thresholds:

```yaml
- alert: ServiceDown
  expr: service_up == 0
  for: 2m  # Change duration here
  labels:
    severity: critical
```

### Setting Up Notifications

Edit `alertmanager/alertmanager.yml`:

```yaml
# Slack notifications
slack_api_url: 'YOUR_SLACK_WEBHOOK_URL'

# Email configuration
smtp_smarthost: 'smtp.gmail.com:587'
smtp_auth_username: 'your-email@gmail.com'
smtp_auth_password: 'your-app-password'
```

## üìä API Endpoints

### Health Checker Service

| Endpoint | Description | Response |
|----------|-------------|----------|
| `GET /` | Web dashboard | HTML |
| `GET /health` | Service health check | `200 OK` |
| `GET /status` | JSON status of all services | JSON |
| `GET /metrics` | Prometheus metrics | Prometheus format |

### Example Status Response
```json
{
  "healthy": true,
  "services": {
    "google": {
      "name": "google",
      "url": "https://www.google.com",
      "healthy": true,
      "response_time_ms": 123,
      "last_checked": "2025-01-20T10:30:00Z",
      "error": ""
    }
  }
}
```

## üê≥ Docker Commands

### Basic Operations
```bash
# Start all services
docker-compose up -d

# Stop all services
docker-compose down

# View logs
docker-compose logs -f [service-name]

# Restart a service
docker-compose restart [service-name]

# View running containers
docker-compose ps
```

### Service-Specific Logs
```bash
# Health Checker logs
docker-compose logs -f health-checker

# Prometheus logs
docker-compose logs -f prometheus

# Grafana logs
docker-compose logs -f grafana
```

## üìà Grafana Dashboard Features

The pre-configured dashboard includes:

- **Service Status Overview** - Real-time UP/DOWN status for all services
- **Response Time Trends** - Historical performance graphs
- **24-Hour Uptime Gauge** - Service availability percentage
- **Health Checks Per Hour** - Monitoring frequency visualization
- **Service Details Table** - Comprehensive service information
- **Auto-refresh** - Updates every 10 seconds

## üîî Alert Examples

Pre-configured alerts:

| Alert | Condition | Severity |
|-------|-----------|----------|
| ServiceDown | Service down for 2+ minutes | Critical |
| HighResponseTime | Response > 5 seconds for 5 minutes | Warning |
| CriticalResponseTime | Response > 10 seconds | Critical |
| HighCPUUsage | CPU > 80% for 5 minutes | Warning |
| HighMemoryUsage | Memory > 90% for 5 minutes | Warning |

## üß™ Development

### Running Locally (without Docker)

```bash
# Run the health checker
go run main.go

# Run tests
go test -v ./...

# Format code
go fmt ./...
```

### Building Binary

```bash
# Windows
go build -o sre-health-checker.exe main.go

# Linux/Mac
go build -o sre-health-checker main.go
```

## üöÄ Production Deployment

### Environment Variables

Create a `.env` file for production:
```env
PROMETHEUS_RETENTION=30d
GRAFANA_ADMIN_PASSWORD=secure-password
ALERT_SLACK_WEBHOOK=https://hooks.slack.com/...
```

### Kubernetes Deployment

Helm charts and Kubernetes manifests coming soon!

### Cloud Deployment

- **AWS**: Use ECS or EKS with Application Load Balancer
- **Azure**: Deploy to AKS or Container Instances
- **GCP**: Use GKE or Cloud Run

## üìö Advanced Configuration

### Custom Prometheus Queries

Access Prometheus at http://localhost:9090 and try:

```promql
# Average response time last 5 minutes
avg(rate(service_response_time_ms[5m]))

# Uptime percentage
avg_over_time(service_up[24h]) * 100

# Services with high response time
service_response_time_ms > 5000
```

### Grafana Dashboard Customization

1. Login to Grafana (admin/admin)
2. Navigate to Dashboards
3. Click "SRE Service Health Dashboard"
4. Click settings icon to edit
5. Add panels for custom metrics

## ü§ù Contributing

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## üìã Roadmap

- [ ] Support for TCP/UDP health checks
- [ ] SSL certificate expiration monitoring
- [ ] Custom health check scripts
- [ ] Webhook notifications
- [ ] Historical data analysis
- [ ] SLA/SLO tracking
- [ ] Multi-region monitoring
- [ ] Kubernetes operator
- [ ] Terraform modules

## üêõ Troubleshooting

### Docker Desktop Not Starting (Windows)
```powershell
# Enable WSL 2
wsl --install
wsl --set-default-version 2

# Restart Docker service
Restart-Service docker
```

### Port Already in Use
```bash
# Find process using port (e.g., 8080)
# Windows
netstat -ano | findstr :8080

# Linux/Mac
lsof -i :8080
```

### Grafana Not Loading Dashboard
```bash
# Restart Grafana
docker-compose restart grafana

# Check logs
docker-compose logs grafana
```

## üìñ Documentation

- [Prometheus Documentation](https://prometheus.io/docs/)
- [Grafana Documentation](https://grafana.com/docs/)
- [AlertManager Documentation](https://prometheus.io/docs/alerting/latest/alertmanager/)
- [Docker Compose Documentation](https://docs.docker.com/compose/)

## üìÑ License

This project is licensed under the MIT License.

## üë§ Author

**b95702041**
- GitHub: [@b95702041](https://github.com/b95702041)

## üôè Acknowledgments

- Built with Go's excellent concurrency primitives
- Inspired by SRE best practices from Google
- Monitoring patterns from Prometheus community
- Dashboard inspiration from Grafana Labs

## üí¨ Support

- Create an [Issue](https://github.com/b95702041/sre-health-checker/issues) for bug reports
- Start a [Discussion](https://github.com/b95702041/sre-health-checker/discussions) for questions
- Check [Wiki](https://github.com/b95702041/sre-health-checker/wiki) for detailed guides

---

Made with ‚ù§Ô∏è for the SRE community